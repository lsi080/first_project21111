import streamlit as st  # Streamlit ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¶ˆëŸ¬ì˜¤ê¸°
import pandas as pd     # ë°ì´í„°í”„ë ˆì„ ì²˜ë¦¬ë¥¼ ìœ„í•œ pandas ë¶ˆëŸ¬ì˜¤ê¸°
import datetime         # ë‚ ì§œ ì…ë ¥ì„ ìœ„í•œ datetime ëª¨ë“ˆ ë¶ˆëŸ¬ì˜¤ê¸°

# ì•± ì œëª© ë° ì„¤ëª… ì¶œë ¥
st.title("ğŸ’° ë‚˜ë§Œì˜ ìš©ëˆ ê°€ê³„ë¶€")
st.write("ìˆ˜ì…ê³¼ ì§€ì¶œì„ ì…ë ¥í•˜ê³ , ë‚˜ì˜ ìš©ëˆì„ ê´€ë¦¬í•´ë³´ì„¸ìš”!")

# ì…ë ¥ëœ ë°ì´í„°ë¥¼ ì €ì¥í•  ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™” (ì„¸ì…˜ ìƒíƒœì— ì €ì¥)
# í˜ì´ì§€ê°€ ë¦¬ë¡œë”©ë˜ì–´ë„ ë°ì´í„°ë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•´ session_state ì‚¬ìš©
if "data" not in st.session_state:
    st.session_state["data"] = []

# ì…ë ¥ í¼ ìƒì„± (í¼ ì´ë¦„ì€ "entry_form")
with st.form("entry_form"):
    # ë‚ ì§œ ì…ë ¥ í•„ë“œ (ê¸°ë³¸ê°’ì€ ì˜¤ëŠ˜ ë‚ ì§œ)
    date = st.date_input("ğŸ“… ë‚ ì§œ", datetime.date.today())

    # í•­ëª© ì„ íƒ (ì¹´í…Œê³ ë¦¬ ê³ ì • ë¦¬ìŠ¤íŠ¸ ì œê³µ)
    category = st.selectbox("ğŸ“‚ í•­ëª©", ["ìš©ëˆ", "ì‹ë¹„", "ê°„ì‹", "êµí†µ", "ê²Œì„", "ê¸°íƒ€"])

    # ì„¤ëª… ì…ë ¥ë€ (ììœ  í…ìŠ¤íŠ¸)
    description = st.text_input("ğŸ“ ì„¤ëª…", "")

    # ê¸ˆì•¡ ì…ë ¥ë€ (ìˆ˜ì…ì€ ì–‘ìˆ˜, ì§€ì¶œì€ ìŒìˆ˜ë¡œ ì…ë ¥)
    amount = st.number_input("ğŸ’¸ ê¸ˆì•¡ (ìˆ˜ì…ì€ +, ì§€ì¶œì€ - ì…ë ¥)", step=100)

    # ì €ì¥ ë²„íŠ¼
    submitted = st.form_submit_button("ì €ì¥í•˜ê¸°")
    
    # ë²„íŠ¼ í´ë¦­ ì‹œ ë°ì´í„° ì €ì¥
    if submitted:
        st.session_state["data"].append({  # ì…ë ¥ëœ ë°ì´í„°ë¥¼ session_stateì— ì¶”ê°€
            "ë‚ ì§œ": date,
            "í•­ëª©": category,
            "ì„¤ëª…": description,
            "ê¸ˆì•¡": amount
        })
        st.success("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!")  # ì €ì¥ ì™„ë£Œ ë©”ì‹œì§€ ì¶œë ¥

# ë°ì´í„°ê°€ ì¡´ì¬í•  ê²½ìš° ì¶œë ¥
if st.session_state["data"]:
    # ë¦¬ìŠ¤íŠ¸ë¥¼ DataFrameìœ¼ë¡œ ë³€í™˜
    df = pd.DataFrame(st.session_state["data"])

    # ì…ë ¥ëœ ë‚´ì—­ ì¶œë ¥
    st.subheader("ğŸ“Š ì…ë ¥ëœ ë‚´ì—­")
    st.dataframe(df, use_container_width=True)  # í™”ë©´ ë„ˆë¹„ì— ë§ì¶° ì¶œë ¥

    # ê¸ˆì•¡ì˜ ì´í•© ê³„ì‚° (í˜„ì¬ ì”ì•¡)
    total = df["ê¸ˆì•¡"].sum()
    st.metric("ğŸ’¼ í˜„ì¬ ì”ì•¡", f"{total:,} ì›")  # ì²œ ë‹¨ìœ„ êµ¬ë¶„ ì‰¼í‘œ í‘œì‹œ

    # í•­ëª©ë³„ ì§€ì¶œ ì°¨íŠ¸ ì¶œë ¥
    st.subheader("ğŸ“ˆ í•­ëª©ë³„ ì§€ì¶œ ë¶„ì„")

    # ê¸ˆì•¡ì´ 0ë³´ë‹¤ ì‘ì€ í•­ëª©ë§Œ ì¶”ì¶œ (ì§€ì¶œë§Œ í•„í„°ë§)
    df_negative = df[df["ê¸ˆì•¡"] < 0]

    if not df_negative.empty:
        # í•­ëª©ë³„ ì§€ì¶œ í•©ê³„ë¥¼ êµ¬í•˜ê³  ì ˆëŒ“ê°’ìœ¼ë¡œ ë³€í™˜
        category_sum = df_negative.groupby("í•­ëª©")["ê¸ˆì•¡"].sum().abs()

        # ë§‰ëŒ€ ì°¨íŠ¸ë¡œ ì‹œê°í™”
        st.bar_chart(category_sum)
    else:
        # ì§€ì¶œ ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° ë©”ì‹œì§€ ì¶œë ¥
        st.info("ì§€ì¶œ ë‚´ì—­ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.")
else:
    # ë°ì´í„°ê°€ ì—†ì„ ë•Œ ì´ˆê¸° ë©”ì‹œì§€ ì¶œë ¥
    st.info("ì…ë ¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ìœ„ì˜ í¼ì„ ì´ìš©í•´ ê¸°ë¡ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”.")
